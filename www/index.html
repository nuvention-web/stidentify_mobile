<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8">
  <meta name="viewport" content="width=device-width">
  <title>My Steroids App</title>

  <link rel="stylesheet" href="/vendor/topcoat/css/topcoat-mobile-light.css" />
  <link rel="stylesheet" href="/stylesheets/application.css" />

  <script src="/javascripts/onerror.js"></script>
  <script src="/javascripts/console.log.js"></script>
  <script src="/javascripts/jquery.min.js"></script>

  <!-- cordova.js is served from localhost to ensure the correct version -->
  <script src="http://localhost/cordova.js"></script>
  <script src="/components/steroids-js/steroids.js"></script>

  <script src="/javascripts/application.js"></script>
</head>
<body>
  <div class="content-padded">

    <h1>Welcome to stidentify</h1>
    
    <form>
      <input name="email" id="email" placeholder="email address" type="text" value="brad@gmail.com">
      <input name="password" id="password" placeholder="password" type="password" value="bradley123">
      <input name="commit" value="sign in" type="submit" id="submit">

    </form>


  </div>

  <script>

    function encodeParams(data){
      return encodeURIComponent(JSON.stringify(data))
    }

    function redirect(data) {
      var testView = new steroids.views.WebView( { location: "http://localhost/test.html?data=" + encodeParams(data) } );

      var myAnimation = new steroids.Animation({
        transition: "curlUp",
        duration: 0.2,
        curve: "easeInOut",
        reversedTransition: "curlDown",
        reversedDuration: 0.4
      });

      steroids.layers.push( {
        view: testView,
        keepLoading: false,
        navigationBar: true,
        tabBar: false,
        animation: myAnimation
      });
    }

    window.onload = function(){

      $('form').on('submit', function(){

        $.support.cors = true;
        $.ajax({
          headers: {          
            Accept: "application/json; charset=utf-8",         
            "Content-Type": "application/json; charset=utf-8"
          },
          url: "http://stidentify.herokuapp.com/api/sessions",
          async: false,
          type: "POST",
          data: JSON.stringify({email:$("#email").val(), password:$("#password").val()}),
          dataType: "json",
          crossDomain: true,
          xhrFields: {
            withCredentials: true
          },
          success: function(data) {
            if (data["response"] = "success") {
              redirect(data);
            } else {
              alert("Try again!");
            }
          }
        })
        
        // navigator.notification.alert(
        //   'Invalid email or password ',  // message
        //   null,                   // callback
        //   'Error',            // title
        //   'Try Again'                  // buttonName
        // );

      });

    }

  </script>
</body>
</html>
